import{ELEMENT_NODE as c,walkSync as d}from"../index.js";function a(t){var n;if(t===void 0)return{allowElements:[],dropElements:["script"],allowComponents:!1,allowCustomElements:!1,allowComments:!1};{let e=new Set([]);(n=t.allowElements)!=null&&n.includes("script")||e.add("script");for(let o of t.dropElements??[])e.add(o);return{allowComponents:!1,allowCustomElements:!1,allowComments:!1,...t,dropElements:Array.from(e)}}}function f(t){return t.name.includes("-")?"custom-element":/[\_\$A-Z]/.test(t.name[0])||t.name.includes(".")?"component":"element"}function p(t,n,e){var o,l,r;return((o=e.allowElements)==null?void 0:o.length)>0&&e.allowElements.includes(t)?"allow":((l=e.blockElements)==null?void 0:l.length)>0&&e.blockElements.includes(t)?"block":((r=e.dropElements)==null?void 0:r.length)>0&&e.dropElements.find(s=>s===t)||n==="component"&&!e.allowComponents||n==="custom-element"&&!e.allowCustomElements?"drop":"allow"}function E(t,n){var o,l,r,s,u,m;let e=t.attributes;for(let i of Object.keys(t.attributes))((o=n.allowAttributes)==null?void 0:o[i])&&((l=n.allowAttributes)==null?void 0:l[i].includes(t.name))||((r=n.allowAttributes)==null?void 0:r[i].includes("*"))||(((s=n.dropAttributes)==null?void 0:s[i])&&((u=n.dropAttributes)==null?void 0:u[i].includes(t.name))||((m=n.dropAttributes)==null?void 0:m[i].includes("*")))&&delete e[i];return e}function w(t,n,e){let o=f(n),{name:l}=n,r=p(l,o,t);return r==="drop"?()=>{e.children=e.children.filter(s=>s!==n)}:r==="block"?()=>{e.children=e.children.map(s=>s===n?s.children:s).flat(1)}:()=>{n.attributes=E(n,t)}}function b(t){let n=a(t);return e=>{let o=[];d(e,(l,r)=>{switch(l.type){case c:{o.push(w(n,l,r));return}default:return}});for(let l of o)l();return e}}export{b as default};
